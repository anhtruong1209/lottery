[phases.setup]
nixPkgs = ["dotnet-sdk_8", "nodejs_20"]

[phases.install]
cmds = [
  "dotnet restore Backend/Backend.csproj",
  "npm install --prefix Frontend"
]

[phases.build]
cmds = [
  "npm run build --prefix Frontend",
  "mkdir -p Backend/wwwroot",
  "cp -r Frontend/dist/* Backend/wwwroot/",
  "dotnet publish Backend/Backend.csproj --no-restore -c Release -o Backend/out"
]

[start]
cmd = "dotnet Backend/out/Backend.dll --urls http://0.0.0.0:$PORT"
